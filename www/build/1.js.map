{"version":3,"sources":["../../src/pages/home/home.module.ts","../../src/pages/home/home.ts"],"names":[],"mappings":"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","file":"1.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { HomePage } from './home';\n@NgModule({\n  declarations: [HomePage],\n  imports: [IonicPageModule.forChild(HomePage)],\n})\nexport class HomePageModule { }\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/home/home.module.ts","import { Component } from '@angular/core';\nimport { Platform } from 'ionic-angular';\nimport { MapProvider } from '../../providers/map/map';\nimport { MyLocation } from '@ionic-native/google-maps';\nimport { Geolocation } from '@ionic-native/geolocation';\nimport { Storage } from '@ionic/storage';\n\n@IonicPage()\n@Component({\n  selector: 'page-home',\n  templateUrl: 'home.html'\n})\nexport class HomePage {\n  mapId: string = \"map_canvas1\";\n  lastUpdateTime: Date = new Date();\n  minFrequency: number = 15000;  // 15-seconds\n  error: string;\n\n  constructor(private map: MapProvider,\n              private geolocation: Geolocation,\n              private storage: Storage,\n              platform: Platform) {\n\n      platform.ready().then(() => {\n        this.setupWatch();\n      }).catch((err) => {\n        console.log(\"Error watching...\", err);\n      });\n  }\n\n  setupWatch() {\n    console.log(\"Setting up watch...\");\n    let watch = this.geolocation.watchPosition();\n    watch.subscribe((data) => {\n      // console.log(\"got subscribed data\", data);\n      if (data.coords === undefined) {\n        return;\n      }\n      this.error = null;\n      // Ignore if its too soon...\n      var now = new Date();\n      const delta = now.getTime() - this.lastUpdateTime.getTime();\n      if(this.lastUpdateTime && delta < this.minFrequency){\n        // console.log(\"Ignoring position update.. too fast\");\n        return;\n      }\n      this.lastUpdateTime = now;\n\n      // Process the update..\n      let coords = {lat: data.coords.latitude, lng: data.coords.longitude};\n      this.storage.get('location').then((val) => {\n        let values = [];\n        if (val) {\n          // Reading the full values is inefficient.. Ideally this should\n          // be a DB table where we just insert rows...\n          values = JSON.parse(val);\n\n          // Add values to the front..\n          values.unshift({...coords, id: values.length + 1});\n        }\n        this.storage.set('location', JSON.stringify(values));\n     }).catch((err) => {\n       console.log('Error accessing location object from local storage', err);\n     });\n     // AttachMap will re-position camera to the new position...\n     this.map.attachMap(this.mapId, coords, data.coords.accuracy);\n   }, (err) => { console.log('Subscribe error', err)});\n  }\n\n  ionViewWillEnter() {\n    console.log('ionViewWillEnter');\n    this.map.getMyLocation().then((location: MyLocation) => {\n      console.log(\"Location \", location, this.map);\n      if (this.map) {\n        this.map.attachMap(this.mapId, location.latLng, location.accuracy);\n      }\n    }).catch((error) => {\n      this.error = error.error_message;\n      console.log('Error get location', error);\n    });\n  }\n\n  ionViewWillLeave() {\n    this.map.detachMap();\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/home/home.ts"],"sourceRoot":""}